== Camel Example Spring Boot MitchConnect

This example shows how to receive and forward SSL encrypted
messages via MLLP. It logs the messages to a SQLite database
in its toplevel directory.  It also includes sample yaml 
routes for sending and receiving without SSL.

Once you see the "Completed initialization in x ms" message,
you can point a web browser to localhost:8080/api/routes2
to see the loaded routes, and to localhost:8080/api/routes2/load
to load a valid yaml file route
or enter valid yaml text to create a route.  (Kaoto is a
wonderful tool for creating yaml routes.)

If the entered yaml is not valid it will not load but there
will be no message.  If it is valid you will see it when
your browser is redirected to /api/routes2.  Because the pom.xml
file includes the dependency camel-spring-boot-starter,
yaml routes should be able to use the following components without
needing adding dependencies:

* bean: Invokes methods on Java beans registered in the Camel registry.
* browse: Inspects messages received on endpoints that support browsing.
* controlbus: Manages and monitors Camel routes.   
* dataformat: Uses Camel data formats as regular Camel components.
* dataset: Provides data for load and soak testing.
* direct: Calls another endpoint within the same Camel context synchronously.   
* language: Executes scripts in various languages supported by Camel (e.g., simple, groovy, etc.).   
* log: Logs message data.
* mock: Mocks endpoints for testing routes.
* ref: Routes messages to endpoints looked up dynamically in the Camel registry.   
* rest: Exposes and consumes RESTful services.
* saga: Implements the Saga pattern for distributed transactions.
* scheduler: Generates messages at specified intervals using java.util.concurrent.ScheduledExecutorService.
* seda: Asynchronously calls another endpoint within the same JVM.   
* stub: Stubs out physical endpoints during development or testing.
* timer: Generates messages at specified intervals using java.util.Timer.
* validator: Validates message payloads using XML schema.
* xpath: Evaluates XPath expressions.
* xslt: Transforms XML payloads using XSLT templates.   

You can Stop and Suspend routes.  Stopped or suspended routes
can be Started.

The application.yaml file is in src/main/resources, and keystore
and truststore and port information is under camel: mllp: ssl:
for the SSL route and camel: mllp: no_ssl: for the unsecured send
and receive routes.

Routes under src/main/resources/loadedroutes are loaded on startup;
routes in src/main/resources/unloadedroutes include hello.yaml 
and hello2.yaml, which just write to the log every two 
and five seconds.  (These are suitable routes to load via 
http://localhost:8080/api/routes2/load or the button on 
http://localhost:8080/api/routes2.)

Some of the listed routes (the DB routes) are just present
and more or less irrelevant; src/main/ssl2/yamlMllpSslRoute.yaml
shows a call to jdbc which writes to the SQLite database
at mydata.db, configured in application.yaml. To prevent the
yamlMllpSslRoute from failing for lack of that db file,
the one line call is commented out with an explanation.
If you create an empty mydata.db, then you can use the body
shown in the createTable route to create a suitable table:
 .setBody(simple("CREATE TABLE IF NOT EXISTS mytable \
 (id INTEGER PRIMARY KEY AUTOINCREMENT, \
 name VARCHAR(255),value VARCHAR(4096), \
 created_at DATETIME DEFAULT CURRENT_TIMESTAMP, \
 route VARCHAR(255)"))
 .to("jdbc:dataSource");


For the sending route to send, place a valid HL7v2 message
in /tmp/hl7msg.txt.  Once sent, it will be moved
to /tmp/sentmessages.

Beware: this is more a learning experience product than anything
showing best practices.  Still, it provides one path to follow
should you run into trouble getting started on something similar.

If you are just exploring the Camel and Spring Boot combo,
please note that Kaoto is a fantastic open source yaml route
graphical designer, and you can use Jconsole to look at route
statistics.  Adding interceptor routines to log all incoming
messages on certain routes is also made straightforward, and
it is easy to swap in different databases.

=== How to run

You can run this example by installing Java 21 and maven and using

    mvn spring-boot:run

=== Help and contributions

This is an in-progress hobby-level effort, and I am by no means
an expert on Camel or Spring Boot or SSL/TLS.  I just realize that
Mirth Connect is going proprietary, that it charges for SSL,
and have long thought that Apache Camel may offer an alternative.

If you hit any problem using Camel or have some feedback on Camel, then please
https://camel.apache.org/support.html[let the Camel Riders know].

If you have questions or comments about this example, which will
develop further along an unknown schedule,
let me know at mjtrac@gmail.com.  Please especially let me know
if you have problems building it; Java 21, maven, and mvn spring-boot:run
should suffice.

Thanks.

Mitch Trachtenberg

=== Images 

The files are in the images directory if they don't render for you
in this document.

==== Wireshark screen caps:

image::images/Unsecured1.png[]

image::images/Unsecured2.png[]

image::images/SSL.png[]

==== Debug output (with SSL debugging)

image::images/UnsecuredSendOutput.png[]

image::images/UnsecuredRcvOutput.png[]

image::images/SecuredRcvAndForwardOutput.png[]

==== Route Management Screen /api/routes2[]

image::images/RouteManagement.png[]

